# ç¬¬ä¸‰æ–¹ç™»å½•é›†æˆæ•™ç¨‹

## ğŸ“‹ æ¦‚è¿°

æœ¬æ•™ç¨‹è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Rookie é¡¹ç›®ä¸­é›†æˆç¬¬ä¸‰æ–¹ç™»å½•ï¼ŒåŒ…æ‹¬é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ç­‰å¹³å°çš„å®Œæ•´é…ç½®æµç¨‹ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- äº†è§£ç¬¬ä¸‰æ–¹ç™»å½•çš„å·¥ä½œåŸç†
- æŒæ¡å„å¹³å°åº”ç”¨åˆ›å»ºå’Œé…ç½®æ–¹æ³•
- å­¦ä¼šåœ¨ç³»ç»Ÿä¸­é…ç½®ç¬¬ä¸‰æ–¹ç™»å½•
- å®ç°ç”¨æˆ·æ‰«ç ç™»å½•åŠŸèƒ½

## ğŸ”§ å‰ç½®å‡†å¤‡

### ç¯å¢ƒè¦æ±‚
- Rookie é¡¹ç›®å·²æ­£å¸¸è¿è¡Œ
- å…·æœ‰ç®¡ç†å‘˜æƒé™
- å¯è®¿é—®ç¬¬ä¸‰æ–¹å¹³å°å¼€å‘è€…åå°

### å¿…è¦ä¿¡æ¯
- ä¼ä¸š/ç»„ç»‡çš„ç¬¬ä¸‰æ–¹å¹³å°è´¦å·
- åº”ç”¨å¼€å‘æƒé™
- å…¬ç½‘å¯è®¿é—®çš„åŸŸå (å¦‚: https://your-domain.com)
- SSLè¯ä¹¦ (æ¨èä½¿ç”¨HTTPS)

## ğŸ“± é’‰é’‰ç™»å½•é›†æˆ

### 1. åˆ›å»ºé’‰é’‰åº”ç”¨

#### è®¿é—®é’‰é’‰å¼€æ”¾å¹³å°
1. ç™»å½• [é’‰é’‰å¼€æ”¾å¹³å°](https://open.dingtalk.com/)
2. è¿›å…¥ `åº”ç”¨å¼€å‘ > ä¼ä¸šå†…éƒ¨åº”ç”¨`
3. ç‚¹å‡» `åˆ›å»ºåº”ç”¨`

#### åº”ç”¨åŸºæœ¬ä¿¡æ¯
```
åº”ç”¨åç§°: Rookieç®¡ç†ç³»ç»Ÿ
åº”ç”¨æè¿°: ä¼ä¸šçº§åº”ç”¨ç®¡ç†å¹³å°
åº”ç”¨å›¾æ ‡: ä¸Šä¼ åº”ç”¨Logo
```

#### é…ç½®åº”ç”¨æƒé™
åœ¨ `æƒé™ç®¡ç†` ä¸­ç”³è¯·ä»¥ä¸‹æƒé™ï¼š
- `é€šè®¯å½•ä¸ªäººä¿¡æ¯è¯»æƒé™`
- `æˆå‘˜ä¿¡æ¯è¯»æƒé™`
- `é€šè®¯å½•éƒ¨é—¨ä¿¡æ¯è¯»æƒé™`

### 2. è·å–åº”ç”¨å‡­è¯

#### é’‰é’‰å‡­è¯è¯´æ˜
é’‰é’‰åº”ç”¨æœ‰å››ä¸ªå‡­è¯å‚æ•°ï¼š

| é’‰é’‰å‡­è¯ | é¡¹ç›®é…ç½®å­—æ®µ | è¯´æ˜ |
|---------|------------|------|
| **App ID** | `app_id` | æ–°ç‰ˆåº”ç”¨æ ‡è¯†ç¬¦ |
| **Client ID** | `client_id` | åŸ AppKey/SuiteKeyï¼Œç”¨äºOAuthæˆæƒ |
| **Client Secret** | `client_secret` | åŸ AppSecret/SuiteSecretï¼Œç”¨äºOAuthæˆæƒ |
| **AgentId** | `agent_id` | ä¼ä¸šå†…éƒ¨åº”ç”¨IDï¼ˆå¯é€‰ï¼‰ |

#### è®°å½•å…³é”®ä¿¡æ¯
```
App ID: dingoa123456789
Client ID: dingoa987654321  # åŸ AppKey
Client Secret: your_dingtalk_client_secret  # åŸ AppSecret
AgentId: 1000001  # ä¼ä¸šå†…éƒ¨åº”ç”¨IDï¼ˆå¯é€‰ï¼‰
```

#### é…ç½®æœåŠ¡å™¨å‡ºå£IP
åœ¨ `å®‰å…¨è®¾ç½®` ä¸­æ·»åŠ æœåŠ¡å™¨IPåœ°å€

### 3. é…ç½®ç™»å½•å›è°ƒ

#### è®¾ç½®å›è°ƒåœ°å€
```
ç™»å½•å›è°ƒåœ°å€: https://your-domain.com/api/users/third_party_callback/
```

#### é…ç½®å¯ä¿¡åŸŸå
```
å¯ä¿¡åŸŸå: your-domain.com
```

**æ³¨æ„**: å›è°ƒåœ°å€å¿…é¡»æ˜¯å…¬ç½‘å¯è®¿é—®çš„åœ°å€ï¼Œç¬¬ä¸‰æ–¹å¹³å°éœ€è¦èƒ½å¤Ÿè®¿é—®åˆ°æ‚¨çš„æœåŠ¡å™¨ã€‚

### 4. ç³»ç»Ÿä¸­é…ç½®é’‰é’‰ç™»å½•

#### è®¿é—®ç®¡ç†åå°
```bash
# è®¿é—®é…ç½®é¡µé¢
http://127.0.0.1:8000/admin/users/thirdpartyauthconfig/
```

#### æ·»åŠ é’‰é’‰é…ç½®
```json
{
  "name": "dingtalk",
  "display_name": "é’‰é’‰ç™»å½•",
  "is_enabled": true,
  "config": {
    "app_id": "dingoa123456789",
    "client_id": "dingoa987654321",
    "client_secret": "your_dingtalk_client_secret",
    "agent_id": "1000001",
    "corp_id": "ding123456789abcdef",
    "redirect_uri": "https://your-domain.com/api/users/third_party_callback/"
  }
}
```

**å‚æ•°è¯´æ˜**:
- `app_id`: æ–°ç‰ˆApp ID
- `client_id`: åŸAppKeyï¼Œç”¨äºOAuthæˆæƒ
- `client_secret`: åŸAppSecretï¼Œç”¨äºOAuthæˆæƒ
- `agent_id`: ä¼ä¸šå†…éƒ¨åº”ç”¨IDï¼ˆå¯é€‰ï¼‰
- `corp_id`: ä¼ä¸šID
- `redirect_uri`: å›è°ƒåœ°å€

### 5. æµ‹è¯•é’‰é’‰ç™»å½•

#### è·å–ç™»å½•äºŒç»´ç 
```bash
curl http://127.0.0.1:8000/api/users/third_party_providers/
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "providers": [
      {
        "name": "dingtalk",
        "display_name": "é’‰é’‰ç™»å½•",
        "auth_url": "https://oapi.dingtalk.com/connect/oauth2/sns_authorize?..."
      }
    ]
  }
}
```

#### æ‰«ç ç™»å½•æµç¨‹
1. è®¿é—®ç™»å½•é¡µé¢: http://127.0.0.1:8000/login/
2. åˆ‡æ¢åˆ° `æ‰«ç ç™»å½•` æ ‡ç­¾
3. é€‰æ‹© `é’‰é’‰ç™»å½•`
4. ä½¿ç”¨é’‰é’‰APPæ‰«ç 
5. ç¡®è®¤ç™»å½•æˆæƒ
6. è‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°

## ğŸ¢ ä¼ä¸šå¾®ä¿¡ç™»å½•é›†æˆ

### 1. åˆ›å»ºä¼ä¸šå¾®ä¿¡åº”ç”¨

#### è®¿é—®ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°
1. ç™»å½• [ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°](https://work.weixin.qq.com/)
2. è¿›å…¥ `åº”ç”¨ç®¡ç† > è‡ªå»ºåº”ç”¨`
3. ç‚¹å‡» `åˆ›å»ºåº”ç”¨`

#### åº”ç”¨åŸºæœ¬ä¿¡æ¯
```
åº”ç”¨åç§°: Rookieç®¡ç†ç³»ç»Ÿ
åº”ç”¨ä»‹ç»: ä¼ä¸šçº§åº”ç”¨ç®¡ç†å¹³å°
åº”ç”¨Logo: ä¸Šä¼ åº”ç”¨å›¾æ ‡
å¯è§èŒƒå›´: é€‰æ‹©ç›¸å…³éƒ¨é—¨æˆ–äººå‘˜
```

### 2. è·å–åº”ç”¨ä¿¡æ¯

#### è®°å½•åº”ç”¨å‡­è¯
```
ä¼ä¸šID (CorpId): ww123456789abcdef
åº”ç”¨ID (AgentId): 1000001
åº”ç”¨Secret: your_wechat_work_secret
```

### 3. é…ç½®ç½‘é¡µæˆæƒ

#### è®¾ç½®å¯ä¿¡åŸŸå
åœ¨ `ç½‘é¡µæˆæƒåŠJS-SDK` ä¸­è®¾ç½®ï¼š
```
å¯ä¿¡åŸŸå: your-domain.com
```

#### é…ç½®æˆæƒå›è°ƒåŸŸ
```
æˆæƒå›è°ƒåŸŸ: your-domain.com
```

### 4. ç³»ç»Ÿä¸­é…ç½®ä¼ä¸šå¾®ä¿¡

#### æ·»åŠ ä¼ä¸šå¾®ä¿¡é…ç½®
```json
{
  "name": "wechat_work",
  "display_name": "ä¼ä¸šå¾®ä¿¡ç™»å½•",
  "is_enabled": true,
  "config": {
    "corp_id": "ww123456789abcdef",
    "agent_id": "1000001",
    "secret": "your_wechat_work_secret",
    "redirect_uri": "http://127.0.0.1:8000/api/users/third_party_callback/"
  }
}
```

### 5. æµ‹è¯•ä¼ä¸šå¾®ä¿¡ç™»å½•

#### ç™»å½•æµç¨‹
1. è®¿é—®ç™»å½•é¡µé¢
2. é€‰æ‹© `ä¼ä¸šå¾®ä¿¡ç™»å½•`
3. ä½¿ç”¨ä¼ä¸šå¾®ä¿¡APPæ‰«ç 
4. ç¡®è®¤ç™»å½•
5. è‡ªåŠ¨åˆ›å»ºç”¨æˆ·å¹¶ç™»å½•

## ğŸ¦ é£ä¹¦ç™»å½•é›†æˆ

### 1. åˆ›å»ºé£ä¹¦åº”ç”¨

#### è®¿é—®é£ä¹¦å¼€æ”¾å¹³å°
1. ç™»å½• [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. è¿›å…¥ `å¼€å‘è€…åå° > åº”ç”¨ç®¡ç†`
3. ç‚¹å‡» `åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨`

#### åº”ç”¨åŸºæœ¬ä¿¡æ¯
```
åº”ç”¨åç§°: Rookieç®¡ç†ç³»ç»Ÿ
åº”ç”¨æè¿°: ä¼ä¸šçº§åº”ç”¨ç®¡ç†å¹³å°
åº”ç”¨å›¾æ ‡: ä¸Šä¼ Logo
```

### 2. é…ç½®åº”ç”¨æƒé™

#### ç”³è¯·æƒé™èŒƒå›´
åœ¨ `æƒé™ç®¡ç†` ä¸­ç”³è¯·ï¼š
- `è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯`
- `è·å–ç”¨æˆ·é‚®ç®±`
- `è·å–ç”¨æˆ·æ‰‹æœºå·`
- `è·å–ç”¨æˆ·éƒ¨é—¨ä¿¡æ¯`

### 3. è·å–åº”ç”¨å‡­è¯

#### è®°å½•å…³é”®ä¿¡æ¯
```
App ID: cli_a123456789abcdef
App Secret: your_feishu_app_secret
```

### 4. é…ç½®é‡å®šå‘URL

#### è®¾ç½®å›è°ƒåœ°å€
```
é‡å®šå‘URL: http://127.0.0.1:8000/api/users/third_party_callback/
```

### 5. ç³»ç»Ÿä¸­é…ç½®é£ä¹¦

#### æ·»åŠ é£ä¹¦é…ç½®
```json
{
  "name": "feishu",
  "display_name": "é£ä¹¦ç™»å½•",
  "is_enabled": true,
  "config": {
    "app_id": "cli_a123456789abcdef",
    "app_secret": "your_feishu_app_secret",
    "redirect_uri": "http://127.0.0.1:8000/api/users/third_party_callback/"
  }
}
```

## ğŸ”§ é«˜çº§é…ç½®

### ç”¨æˆ·ä¿¡æ¯åŒæ­¥

#### å½“å‰æ”¯æŒçš„åŒæ­¥æ–¹å¼

**æ‰‹åŠ¨åŒæ­¥**: ç›®å‰é¡¹ç›®æ”¯æŒæ‰‹åŠ¨è§¦å‘ç”¨æˆ·åŒæ­¥

**è‡ªåŠ¨åŒæ­¥**: æš‚æœªå®ç°ï¼Œå¯ä½œä¸ºåç»­åŠŸèƒ½æ‰©å±•

#### åŒæ­¥å­—æ®µè¯´æ˜
ç¬¬ä¸‰æ–¹ç™»å½•æ—¶ä¼šè‡ªåŠ¨åŒæ­¥ä»¥ä¸‹ç”¨æˆ·ä¿¡æ¯ï¼š
- `username` - ç”¨æˆ·å/æ˜µç§°
- `email` - é‚®ç®±åœ°å€
- `phone` - æ‰‹æœºå·ç 
- `department` - éƒ¨é—¨ä¿¡æ¯
- `job_title` - èŒä½ä¿¡æ¯
- `employee_id` - å‘˜å·¥ç¼–å·
- `avatar` - å¤´åƒåœ°å€

#### æ‰‹åŠ¨åŒæ­¥ç”¨æˆ·

**é€šè¿‡APIåŒæ­¥**:
```bash
curl -X POST http://127.0.0.1:8000/api/users/sync_users/ \
  -H "Authorization: Token your_token" \
  -H "Content-Type: application/json" \
  -d '{"provider": "dingtalk"}'
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "code": 200,
  "message": "åŒæ­¥å®Œæˆï¼Œå…±åŒæ­¥ 15 ä¸ªç”¨æˆ·",
  "data": {
    "count": 15
  }
}
```

**æ³¨æ„**: æ­¤åŠŸèƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œä¸”ç¬¬ä¸‰æ–¹å¹³å°éœ€æ”¯æŒç”¨æˆ·åˆ—è¡¨è·å–API

### å¤šå¹³å°ç™»å½•

#### åŒæ—¶å¯ç”¨å¤šä¸ªå¹³å°
```json
[
  {
    "name": "dingtalk",
    "display_name": "é’‰é’‰ç™»å½•",
    "is_enabled": true
  },
  {
    "name": "wechat_work",
    "display_name": "ä¼ä¸šå¾®ä¿¡ç™»å½•",
    "is_enabled": true
  },
  {
    "name": "feishu",
    "display_name": "é£ä¹¦ç™»å½•",
    "is_enabled": true
  }
]
```

#### ç™»å½•é¡µé¢æ•ˆæœ
ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ç§æ–¹å¼ç™»å½•ï¼š
- è´¦å·å¯†ç ç™»å½•
- é’‰é’‰æ‰«ç ç™»å½•
- ä¼ä¸šå¾®ä¿¡æ‰«ç ç™»å½•
- é£ä¹¦æ‰«ç ç™»å½•

## ğŸ› ï¸ è‡ªå®šä¹‰æ’ä»¶å¼€å‘

### åˆ›å»ºæ–°çš„ç™»å½•æ’ä»¶

#### 1. åˆ›å»ºæ’ä»¶æ–‡ä»¶
```python
# plugins/github.py
from .base import BaseAuthPlugin
import requests

class GitHubAuthPlugin(BaseAuthPlugin):
    @property
    def name(self) -> str:
        return 'github'

    @property
    def display_name(self) -> str:
        return 'GitHubç™»å½•'

    def get_auth_url(self) -> str:
        """ç”ŸæˆGitHub OAuthæˆæƒURL"""
        client_id = self.config.get('client_id')
        redirect_uri = self.config.get('redirect_uri')

        return f"https://github.com/login/oauth/authorize?client_id={client_id}&redirect_uri={redirect_uri}&scope=user:email"

    def get_user_info(self, code: str) -> dict:
        """è·å–GitHubç”¨æˆ·ä¿¡æ¯"""
        # 1. è·å–access_token
        token_data = self._get_access_token(code)
        access_token = token_data.get('access_token')

        # 2. è·å–ç”¨æˆ·ä¿¡æ¯
        user_info = self._get_user_profile(access_token)

        # 3. æ ‡å‡†åŒ–è¿”å›æ ¼å¼
        return {
            'source': 'github',
            'external_id': str(user_info.get('id')),
            'username': user_info.get('login'),
            'email': user_info.get('email'),
            'avatar': user_info.get('avatar_url')
        }
```

#### 2. æ³¨å†Œæ’ä»¶
```python
# plugins/manager.py
from .github import GitHubAuthPlugin

class PluginManager:
    def _load_plugins(self):
        plugin_classes = [
            DingTalkAuthPlugin,
            WeChatWorkAuthPlugin,
            FeishuAuthPlugin,
            GitHubAuthPlugin,  # æ–°å¢æ’ä»¶
        ]
```

#### 3. é…ç½®æ–°æ’ä»¶
```json
{
  "name": "github",
  "display_name": "GitHubç™»å½•",
  "is_enabled": true,
  "config": {
    "client_id": "your_github_client_id",
    "client_secret": "your_github_client_secret",
    "redirect_uri": "http://127.0.0.1:8000/api/users/third_party_callback/"
  }
}
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: æ‰«ç åæç¤º"åº”ç”¨æœªæˆæƒ"
**A**: æ£€æŸ¥ä»¥ä¸‹é…ç½®
```bash
# 1. ç¡®è®¤åº”ç”¨æƒé™å·²ç”³è¯·å¹¶é€šè¿‡
# 2. æ£€æŸ¥å¯ä¿¡åŸŸåé…ç½®
# 3. ç¡®è®¤å›è°ƒåœ°å€æ­£ç¡®
# 4. æ£€æŸ¥IPç™½åå•è®¾ç½®
```

### Q: ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥
**A**: æ£€æŸ¥æƒé™é…ç½®
```bash
# 1. ç¡®è®¤å·²ç”³è¯·ç”¨æˆ·ä¿¡æ¯è¯»å–æƒé™
# 2. æ£€æŸ¥åº”ç”¨Secretæ˜¯å¦æ­£ç¡®
# 3. ç¡®è®¤ç”¨æˆ·åœ¨ç»„ç»‡æ¶æ„ä¸­
# 4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
```

### Q: å›è°ƒåœ°å€è®¿é—®å¤±è´¥
**A**: æ£€æŸ¥ç½‘ç»œé…ç½®
```bash
# 1. ç¡®è®¤å›è°ƒåœ°å€å¯ä»¥è¢«ç¬¬ä¸‰æ–¹å¹³å°è®¿é—®
# 2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
# 3. ç¡®è®¤åŸŸåè§£ææ­£ç¡®
# 4. æµ‹è¯•ç½‘ç»œè¿é€šæ€§
```

### Q: ç”¨æˆ·é‡å¤åˆ›å»º
**A**: æ£€æŸ¥ç”¨æˆ·åŒ¹é…é€»è¾‘
```bash
# 1. ç¡®è®¤external_idå­—æ®µæ­£ç¡®
# 2. æ£€æŸ¥é‚®ç®±åŒ¹é…é€»è¾‘
# 3. æŸ¥çœ‹ç”¨æˆ·åˆ›å»ºæ—¥å¿—
# 4. æ‰‹åŠ¨æ¸…ç†é‡å¤ç”¨æˆ·
```

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒé…ç½®

### æœ¬åœ°å¼€å‘è§£å†³æ–¹æ¡ˆ

ç”±äºç¬¬ä¸‰æ–¹å¹³å°éœ€è¦è®¿é—®å…¬ç½‘åœ°å€ï¼Œæœ¬åœ°å¼€å‘æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ1: ä½¿ç”¨ngrokå†…ç½‘ç©¿é€
```bash
# å®‰è£…ngrok
brew install ngrok  # macOS
# æˆ–ä¸‹è½½: https://ngrok.com/download

# å¯åŠ¨ç©¿é€
ngrok http 8000

# è·å¾—å…¬ç½‘åœ°å€
# https://abc123.ngrok.io -> http://localhost:8000
```

#### æ–¹æ¡ˆ2: ä½¿ç”¨äº‘æœåŠ¡å™¨
```bash
# éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•
# é…ç½®åŸŸåå’ŒSSLè¯ä¹¦
```

#### æ–¹æ¡ˆ3: ä½¿ç”¨æµ‹è¯•ç¯å¢ƒ
```bash
# æ­å»ºä¸“é—¨çš„æµ‹è¯•ç¯å¢ƒ
# ä½¿ç”¨å›ºå®šçš„æµ‹è¯•åŸŸå
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. åº”ç”¨å¯†é’¥ä¿æŠ¤
- ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ²Secret
- å®šæœŸæ›´æ¢åº”ç”¨å¯†é’¥
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯

### 2. å›è°ƒåœ°å€éªŒè¯
- ä½¿ç”¨HTTPSåè®®
- éªŒè¯stateå‚æ•°é˜²æ­¢CSRF
- æ£€æŸ¥æ¥æºIPåœ°å€

### 3. ç”¨æˆ·ä¿¡æ¯ä¿æŠ¤
- æœ€å°åŒ–æƒé™ç”³è¯·
- åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- å®šæœŸæ¸…ç†æ— æ•ˆæ•°æ®

## ğŸ“Š ç›‘æ§å’Œç»Ÿè®¡

### ç™»å½•ç»Ÿè®¡
```bash
# æŸ¥çœ‹ç¬¬ä¸‰æ–¹ç™»å½•ç»Ÿè®¡
curl -H "Authorization: Token your_token" \
     http://127.0.0.1:8000/api/users/statistics/
```

### æ—¥å¿—ç›‘æ§
```bash
# æŸ¥çœ‹ç¬¬ä¸‰æ–¹ç™»å½•æ—¥å¿—
tail -f logs/dev.log | grep "ç¬¬ä¸‰æ–¹ç™»å½•"
```

## ğŸš€ åŠŸèƒ½æ‰©å±•

### è‡ªåŠ¨åŒæ­¥åŠŸèƒ½å¼€å‘

å¦‚æœéœ€è¦å®ç°è‡ªåŠ¨åŒæ­¥åŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š

#### 1. ä½¿ç”¨Celeryå®šæ—¶ä»»åŠ¡
```python
# tasks.py
from celery import shared_task
from plugins.manager import plugin_manager

@shared_task
def sync_third_party_users():
    """Celeryå®šæ—¶åŒæ­¥ä»»åŠ¡"""
    configs = ThirdPartyAuthConfig.objects.filter(is_enabled=True)
    for config in configs:
        plugin = plugin_manager.get_plugin(config.name, config.config)
        if plugin:
            count = plugin.sync_users()
            logger.info(f"åŒæ­¥{config.display_name}ç”¨æˆ·: {count}ä¸ª")
```

#### 2. æ‰©å±•ç¬¬ä¸‰æ–¹é…ç½®æ¨¡å‹
```python
# models.py
class ThirdPartyAuthConfig(models.Model):
    # ... ç°æœ‰å­—æ®µ

    # æ–°å¢åŒæ­¥é…ç½®å­—æ®µ
    auto_sync_enabled = models.BooleanField('å¯ç”¨è‡ªåŠ¨åŒæ­¥', default=False)
    sync_interval = models.IntegerField('åŒæ­¥é—´éš”(ç§’)', default=3600)
    last_sync_time = models.DateTimeField('ä¸Šæ¬¡åŒæ­¥æ—¶é—´', null=True, blank=True)
```

#### 3. Adminåå°é…ç½®ç•Œé¢
```python
# admin.py
class ThirdPartyAuthConfigAdmin(admin.ModelAdmin):
    list_display = ['display_name', 'is_enabled', 'auto_sync_enabled', 'last_sync_time']
    fieldsets = [
        ('åŸºæœ¬ä¿¡æ¯', {'fields': ['name', 'display_name', 'is_enabled']}),
        ('é…ç½®ä¿¡æ¯', {'fields': ['config']}),
        ('åŒæ­¥è®¾ç½®', {'fields': ['auto_sync_enabled', 'sync_interval']}),
    ]
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è®¤è¯ç³»ç»Ÿ](../user-guide/authentication.md) - è®¤è¯æœºåˆ¶è¯¦è§£
- [ç”¨æˆ·ç®¡ç†](../user-guide/admin-panel.md) - ç”¨æˆ·ç®¡ç†åå°
- [APIå‚è€ƒ](../api-reference/authentication.md) - è®¤è¯æ¥å£æ–‡æ¡£
- [æ•…éšœæ’é™¤](../troubleshooting/common-issues.md) - å¸¸è§é—®é¢˜è§£å†³
